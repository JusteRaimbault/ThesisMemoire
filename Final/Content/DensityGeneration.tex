

%---------------------------------------------------

\newpage

\section{Urban Morphogenesis by Aggregation-diffusion}{Morphogen√®se Urbaine par Agr√©gation-diffusion}

\label{sec:densitygeneration}


%---------------------------------------------------

\comment[CC]{transition manquante entre conclusions de l'epistemo interdisciplinaire (5.1) et objectifs du 5.2. Notamment, dans quelle mesure la connaissance interdisciplinaire de la morphogenese va permettre d'en faire un modele plus interessant pour la ville que si on n'avait pas cette connaissance epistemo.}

\bpar{
We study a stochastic model of urban growth generating spatial distributions of population densities at an intermediate mesoscopic scale. The model is based on the antagonist interplay between the two opposite abstract processes of aggregation (preferential attachment) and diffusion (urban sprawl). Introducing indicators to quantify precisely urban form, the model is first statistically validated and intensively explored to understand its complex behavior across the parameter space. We then compute real morphological measures on local areas of size 50km covering all European Union, and show that the model can reproduce most of existing urban morphologies in Europe. It implies that the morphological dimension of urban growth processes at this scale are sufficiently captured by the two abstract processes of aggregation and diffusion.
}{
Nous √©tudions un mod√®le stochastique de croissance urbain g√©n√©rant des distribution \comment[CC]{s} spatiales de densit√© de population √  une √©chelle interm√©diaire mesoscopique. Le mod√®le se base sur le jeu antagoniste entre les deux processus abstrait \comment[CC]{s} oppos√© \comment[CC]{s} de l'agr√©gation (attachement pr√©f√©rentiel) et de la diffusion (√©talement urbain). En utilisant des indicateurs pour quantifier pr√©cis√©ment la forme urbaine, le mod√®le est d'abord valid√© statistiquement puis explor√© intensivement pour comprendre son comportement complexe sur son espace de param√®tres. Ayant calcul√© pr√©c√©demment les mesures morphologiques r√©elles sur des aires locales de taille 50km couvrant l'ensemble de l'Union Europ√©enne, nous les utilisons pour montrer que le mod√®le peut reproduire la plupart des morphologies urbaines existantes en Europe. Cela implique que la dimension morphologique des processus de croissance urbaine √  cette √©chelle est captur√©e de mani√®re suffisante par les deux processus abstraits d'agr√©gation et de diffusion.
}


\subsection{Context}{Contexte}


\bpar{
The study of urban growth, and more particularly its quantification, is more than ever a crucial issue in a context where most of the world population live in cities which expansion has significant environmental impacts~\cite{seto2012global} and that have therefore to ensure an increased sustainability and resilience to climate change. The understanding of drivers for urban growth can lead to better integrated policies. It is however a question far from being solved in the diverse related disciplines: Urban Systems are complex socio-technical systems that can be studied from a large variety of viewpoints. Batty has advocated in that sense for the construction of a dedicated science defined by its objects of study more than the methods used~\cite{batty2013new}, what would allow easier coupling of approaches and therefore Urban Growth models taking into account heterogeneous processes. The processes that a model can grasp are also linked to the choice of the scale of study. At a macroscopic scale, models of growth in system of cities are mainly the concern of economics and geography. \cite{gabaix1999zipf} shows that in first approximation, the Gibrat's model postulating random growth rates not depending on city size, yield the well-know Zipf's law, or rank-size law, which is a typical stylized fact witnessing hierarchy in systems of cities. It was however shown empirically that systematic deviations to this law exist~\cite{rozenfeld2008laws}, and that spatial interactions may be responsible for it. Models integrating spatial interactions include for example \cite{bretagnolle2000long} that introduces a growth model in which these interactions, that are function of distance and the geography, play a significant role in growth rates. More recently, \cite{favaro2011gibrat} has extended this model by taking into account innovation waves between cities as a driver. The interplay of space, economic and population growth is studied by the Marius model~\cite{cottineau2014evolution} in the case of the former Soviet Union, on which model performance is shown improved compared to models without interactions.
}{
L'√©tude de la croissance urbaine, et plus particuli√®rement sa quantification, est plus que jamais un enjeu crucial dans un contexte ou \comment[CC]{avec accent} la majorit√© de la population mondiale vit dans des villes dont l'expansion a des impacts environnementaux significatifs~\cite{seto2012global} et qui doivent pour cela assurer une soutenabilit√© et une r√©silience au changement climatique accrues. La compr√©hension des moteurs de la croissance urbaine devrait conduire √† l'√©laboration de politiques mieux int√©gr√©es. Il s'agit cependant d'une question loin d'√™tre r√©solue dans les diverses disciplines concern√©es: les syst√®mes urbains sont des syst√®mes socio-techniques complexes qui peuvent √™tre √©tudi√©s d'une grande vari√©t√© de points de vue. \noun{Batty} d√©fend en ce sens la construction d'une science d√©di√©e d√©finie par ses objets d'√©tude plus que par les m√©thodes utilis√©es~\cite{batty2013new}, ce qui devrait permettre des couplages plus faciles entre approches et donc des mod√®les de croissance urbaine prenant en compte des processus h√©t√©rog√®nes. Les processus qu'un mod√®le peut prendre en compte sont √©galement li√©s au choix de l'√©chelle d'√©tude. A une √©chelle macroscopique, les mod√®les de croissance pour les syst√®mes de villes sont majoritairement le sujet de l'√©conomie et de la g√©ographie. \cite{gabaix1999zipf} \comment[CC]{et Gibrat avant lui} montre qu'en premi√®re approximation, le mod√®le de Gibrat postulant des taux de croissance al√©atoires ne d√©pendant pas de la taille des villes, produit la bien connue loi de Zipf, ou loi rang-taille, qui est un fait stylis√© typique t√©moignant d'une hi√©rarchie dans les syst√®mes de villes. Il a cependant √©t√© d√©montr√© empiriquement que des d√©viations syst√©matiques √† cette loi existent~\cite{rozenfeld2008laws}, et que les interactions spatiales pourraient en √™tre responsables. Les mod√®les int√©grant les interactions spatiales incluent par exemple \cite{bretagnolle2000long} qui introduit un mod√®le de croissance dans lequel ces interactions, qui sont fonction de la distance et de la g√©ographie, jouent un r√¥le significatif dans les taux de croissance. Plus r√©cemment, \cite{favaro2011gibrat} a √©tendu ce mod√®le en prenant en compte les vagues d'innovation entre les villes comme facteur d'influence. Les relations entre espace, croissance √©conomique et croissance de la population sont √©tudi√©es par le mod√®le Marius~\cite{cottineau2014evolution} pour le cas de l'ex-Union Sovi√©tique, pour lequel la performance du mod√®le est d√©montr√©e am√©lior√©e par rapport aux mod√®les sans interactions.
}

\bpar{
At smaller scales, that can be understood as microscopic or mesoscopic depending on the resolution and extent of models, agents of models fundamentally differ. Space is generally taken into account in a finer way, through neighborhood effects for example. For example, \cite{andersson2002urban} propose a micro-based model of urban growth, with the purpose to replace non-interpretable physical mechanisms with agent mechanisms, including interactions forces and mobility choices. Local correlations are used in \cite{makse1998modeling}, which develops the model introduced in~\cite{makse1995modelling}, to modulate growth patterns to ressemble real configurations. The world of Cellular Automata (CA) models of Urban Growth~\cite{batty1994cells} also offers numerous examples. \cite{GEAN:GEAN940} introduced a generic framework for CA with multiple land use, based on local evolution rules. A model with simpler states (occupied or not) but taking into account global constraints is studied by \cite{ward2000stochastically}. The Sleuth model, initially introduced by \cite{clarke1998loose} for the San Francisco Bay area, and for which an overview of diverse applications is given in~\cite{clarke2007decade}, was calibrated on areas all over the world, yielding comparative measures through the calibrated parameters.
}{
A de plus petites √©chelles \comment[CC]{cf. infra; petite echelle = grand territoire}, qui peuvent √™tre comprises comme microscopiques ou mesoscopiques selon la r√©solution et l'√©tendue spatiale des mod√®les, les agents des mod√®les diff√®rent fondamentalement. L'espace est g√©n√©ralement pris en compte de mani√®re plus fine, par les effets de voisinage par exemple. Par exemple \comment[CC]{par exemple par exemple}, \cite{andersson2002urban} un mod√®le de croissance urbaine bas√© sur le microscopique, dans le but de remplacer des m√©canismes physiques non interpr√©tables par des m√©canismes d'agents, incluant des forces d'interaction et des choix de mobilit√© \comment[CC]{il manque un verbe}. Les corr√©lations locales sont utilis√©es par \cite{makse1998modeling}, qui d√©veloppe le mod√®le introduit dans \cite{makse1995modelling}, pour moduler les motifs de croissance pour qu'ils ressemblent √† des configurations r√©elles. Le monde des mod√®les de croissance urbaine √† automates cellulaires (CA)~\cite{batty1994cells} offre aussi de nombreux exemples. \cite{GEAN:GEAN940} introduit un cadre g√©n√©rique pour les CA avec usage du sol multiple, bas√© sur des r√®gles d'√©volution locales. Un mod√®le avec des √©tats plus simples (occup√© ou non) mais prenant en compte des contraintes globales est √©tudi√© par~\cite{ward2000stochastically}. Le mod√®le Sleuth, introduit initialement par~\cite{clarke1998loose} pour la zone de la Baie de San Francisco, et pour lequel un aper√ßu des diverses applications est donn√© dans~\cite{clarke2007decade}, a √©t√© calibr√© sur des r√©gions tout autour du monde, fournissant des mesures comparatives au travers des param√®tres calibr√©s.
}


\bpar{
Closely related to CA models but not exactly similar are Urban Morphogenesis models, which aim to simulate the growth of urban form from autonomous rules. \cite{frankhauser1998fractal} suggested that the fractal nature of cities is closely linked to the emergence of the form from the microscopic socio-economic interactions, namely urban morphogenesis. \cite{courtat2011mathematics} develops a morphogenesis model for urban roads alone, with growth rules based on geometrical considerations. These are shown sufficient to produce a broad range of patterns analog to existing ones. Similarly, \cite{raimbault2014hybrid} couples a CA with an evolving network to reproduce stylized urban form, from concentrated monocentric cities to sprawled suburbs. The Diffusion-Limited-Aggregation model, coming from physics, and which was first studied for cities by~\cite{batty1991generating}, can also be seen as a morphogenesis model. These kind of models, that sometimes can be classified as CA, have generally the particularity of being parsimonious in their structure.
}{
Assez proches des mod√®les CA, mais pas exactement similaires  \comment[CC]{reformuler. et puisqu'on a deja lu toute une partie sur la morphogenese, autant insister. Par exemple: Enfin, assez proche des CA, mais plus proches de notre interet dans cette partie}, sont les mod√®les de Morphogen√®se Urbaine, qui visent √† simuler la croissance de la forme urbaine √† partir de r√®gles autonomes. \cite{frankhauser1998fractal} sugg√®re que la nature fractale des villes est en relation √©troite avec l'√©mergence de la forme urbaine √† partir des interactions socio-√©conomiques microscopiques, √† savoir la morphogen√®se urbaine. \cite{courtat2011mathematics} d√©veloppe un mod√®le de morphogen√®se pour les routes urbaines seules, avec des r√®gles de croissance bas√©es sur des consid√©rations g√©om√©triques. Celles ci sont montr√©es suffisantes pour produire un large spectre de motifs analogues √† des existants. De mani√®re similaire, \cite{raimbault2014hybrid} couple un CA avec un r√©seau √©volutif pour reproduire des formes urbaines stylis√©es, de villes monocentriques concentr√©es √† des banlieues √©tal√©es. Le mod√®le Diffusion-Limited-Aggregation, venant de la physique, et qui a √©t√© appliqu√© aux villes en premier par~\cite{batty1991generating}, peut aussi √™tre vu comme un mod√®le de morphogen√®se. Ce type de mod√®les, qui peuvent parfois √™tre classifi√©s comme CA, ont g√©n√©ralement la particularit√© d'√™tre parcimonieux dans leur structure. Des mod√®les similaires ont √©galement √©t√© √©tudi√©s en biologie pour la diffusion de population par exemple~\cite{bosch1990velocity}. \comment[CC]{certains de ces modeles ont ete introduits en 5.1., donc au lieu de faire des repetitions, essaye de montrer en quoi ils different des autres modeles presentes plus haut et en quoi ils t'interessent. notamment, je n'ai pas l'impression que le modele utilise parle de fonctions, or c'etait important plus haut...}
}


\bpar{
We study in this section a morphogenesis model, at the mesoscopic scale, aimed at being simplistic in its rules and variables, but trying to be accurate in the reproduction of existing patterns. The underlying question is to explore the performance of simple mechanisms in reproducing complex urban patterns. We consider abstract processes, namely aggregation and diffusion, candidates as partially explanatory drivers of urban growth, based on population only, that will be detailed in model rationale below. An important aspect we introduce is the quantitative measure of urban form, based on a combination of morphological indicators, to quantify and compare model outputs and real urban patterns. Our contribution is significant on several points: (i) we compute local morphological characteristics on a large spatial extent (full European Union); (ii) we give significant insights into model behavior through extensive exploration of the parameter space; (iii) we show through calibration that the model is able to reproduce most of existing urban forms across Europe, and that these abstract processes are sufficient to explain urban form alone. The rest of this paper is organized as follows: we first describe formally the model and the morphological indicators. We then detail values of morphological measures on real data, study the behavior of the model by exploring its parameter space and through a semi-analytical approach to a simplified case, and we describe results of model calibration.
}{
Nous √©tudions dans cette section un mod√®le de morphogen√®se, √† l'√©chelle mesoscopique, dont le but est d'√™tre simple dans ses r√®gles et variables, mais visant √† √™tre performant pour la reproduction de motifs existants. \comment[CC]{plutot reformuler a l'envers: le but est de reproduire les motifs, sous contrainte de simplicite} La question sous-jacente est l'exploration de la performance de m√©canismes simples pour reproduire des formes urbaines complexes. Nous consid√©rons des processus abstrait \comment[CC]{s}, pr√©cis√©ment l'agr√©gation et la diffusion, comme candidats comme facteurs \comment[CC]{candidat OU facteur} potentiellement explicatifs de la croissance urbaine, bas√©s sur la densit√© de population seule, qui seront d√©taill√©s ci-dessous. Un aspect important que nous utilisons est la mesure quantitative de la forme urbaine, bas√©e sur une combinaison d'indicateurs morphologiques, pour quantifier et comparer les sorties de mod√®le et les formes urbaines r√©elles. Notre contribution est significative sur plusieurs points: (i) le calcul des caract√©ristiques morphologiques r√©elles sur une √©tendue spatiale cons√©quente (Union Europ√©enne compl√®te); (ii) nous apprenons le comportement du mod√®le par une exploration cons√©quente de l'espace des param√®tres; (iii) nous montrons par la calibration que le mod√®le est capable de reproduire la majorit√© des formes urbaines existantes en Europe, et que ces processus abstraits sont suffisants pour expliquer la forme urbaine seule. La suite de cette section est organis√©e de la fa√ßon suivante : nous d√©crivons d'abord formellement le mod√®le. Nous √©tudions ensuite le comportement du mod√®le par une exploration de l'espace des param√®tres et par une approche semi-analytique d'un cas simplifi√©, puis nous d√©crivons les r√©sultats de la calibration du mod√®le \comment[CC]{Cool}.\comment[FL]{revue de litt pas assez hierarchisee}
}





\subsection{Model and Results}{Mod√®le et R√©sultats}



\subsubsection{Urban growth model}{Mod√®le de croissance urbaine}




%%%%%%%%%%%%%%%%%%%%%%%%
\paragraph{Rationale}{Description}

\bpar{
Our model is based on widely accepted ideas of diffusion-aggregation processes for Urban Processes. The combination of attraction forces with repulsion, due for example to congestion, already yield a complex outcome that has been shown under some simplifying assumptions to be representative of urban growth processes. A model capturing these processes was introduced by~\cite{batty2006hierarchy}, as a cell-based variation of the DLA model~\cite{batty1991generating}. Indeed, the tension between antagonist aggregation and sprawl mechanisms may be an important process in urban morphogenesis. For example \cite{fujita1996economics} opposes centrifugal forces with centripetal forces in the equilibrium view of urban spatial systems, what is easily transferable to non-equilibrium systems in the framework of self-organized complexity: a urban structure is a far-from-equilibrium system that has been driven to this point by these opposite forces. The two contradictory processes of urban concentration and urban sprawl are captured by the model, what allows to reproduce with a good precision a large number of existing morphologies. We can expect aggregation mechanisms such as preferential attachment to be good candidates in urban growth explanation, as it was shown that the Simon model based on them generates power-laws typical of urban systems (scaling laws for example)~\cite{2016arXiv160806313S}. The question at which scale is it possible and relevant to define and try to simulate urban form is rather open, and will in fact depend on which issues are being tackled. Working in a typical setting of morphogenesis, the processes considered are local and our model must have a resolution at the micro-level. We however want to quantify urban form on consistent urban entities, and will work therefore on spatial extents of order 50$\sim$100km. We sum up these two aspects by stating that the model is at the \emph{mesoscopic scale}.
}{
Notre mod√®le est bas√© sur des id√©es largement accept√©es de processus d'agr√©gation-diffusion pour les les \comment[CC]{doublon} processus urbains. La combinaison de forces d'attraction avec celles de r√©pulsion, dues par exemple √† la congestion, fournit d√©j√† une issue complexe qui a √©t√© montr√©e repr√©sentative des processus de croissance urbaine sous certaines hypoth√®ses simplificatrices. Un mod√®le capturant ces processus a √©t√© introduit dans~\cite{batty2006hierarchy}, comme une variation cellulaire du mod√®le DLA~\cite{batty1991generating}. En effet, la tension entre les m√©canismes antagonistes d'agr√©gation et d'√©talement peut √™tre un processus important pour la morphogen√®se urbaine. Par exemple, \cite{fujita1996economics} oppose les forces centrifuges aux forces centrip√®tes \comment[CC]{des exemples de ces forces pour illustrer les processus urbains: congestion, commerce etc. Ca te permet de faire le parallele avec les systemes complexes tout en indiquant au lecteur geographe ce que ca represente "dans la vraie vie"} dans une vision d'√©quilibre des syst√®mes urbains spatiaux, ce qui peut facilement √™tre transf√©r√© aux syst√®mes hors √©quilibre dans le cadre de la complexit√© auto-organis√©e: une structure urbaine est un syst√®me \emph{far-from-equilibrium} qui a √©t√© conduit √† ce point par ces forces oppos√©es. Les deux processus contradictoires de concentration urbaine et d'√©talement urbain sont captur√©s par le mod√®le, ce qui permet de reproduire avec une bonne pr√©cision un grand nombre de morphologies existantes. Nous pouvons supposer que des m√©canismes d'agr√©gation comme l'attachement pr√©f√©rentiel sont des bons candidats pour expliquer la croissance urbaine, puisqu'il a √©t√© montr√© que le mod√®le de Simon qui se base dessus \comment[CC]{a reformuler} g√©n√®re des \emph{power-law} qui sont typiques des syst√®mes urbains (lois d'√©chelles par exemple)~\cite{2016arXiv160806313S}. La question de l'√©chelle √† laquelle il est possible et pertinent de d√©finir et d'essayer de simuler la croissance urbaine est relativement ouverte, et d√©pendra en fait de quels probl√®mes sont consid√©r√©s. Travaillant dans un cadre typique de la morphogen√®se, les processus consid√©r√©s sont locaux et notre mod√®le doit avoir une r√©solution au niveau microscopique. Nous voulons cependant quantifier la forme sur des unit√©s urbaines coh√©rentes, et travaillerons ainsi sur des √©tendues spatiales d'ordre 50$\sim$100km. Nous r√©sumons ces deux aspects en posant que le mod√®le est √† l'√©chelle \emph{mesoscopique}.
}

\paragraph{Formalization}{Formalisation}

\bpar{
We formalize now the model and its parameters. The world is a square grid of width $N$, in which each cell is characterized by its population $(P_i(t))_{1\leq i\leq N^2}$. We consider the grid initially empty, i.e. $P_i(0)=0$, but the model can be easily generalized to any initial population distribution. The population distribution is updated in an iterative way. At each time step,
}{
Nous formalisons √† pr√©sent le mod√®le et ses param√®tres. Le monde \comment[CC]{du modele} est une grille carr√©e de c√¥t√© $N$, dans lequel chaque cellule est caract√©ris√©e par sa population $(P_i(t))_{1\leq i\leq N^2}$. Nous consid√©rons la grille initialement vide, i.e. $P_i(0)=0$, mais le mod√®le peut √™tre facilement g√©n√©ralis√© √† n'importe quelle distribution initiale de population. La distribution de population est mise √† jour de fa√ßon it√©rative. A chaque pas de temps,
}

\bpar{
\begin{enumerate}
\item Total population is increased by a fixed number $N_G$ (growth rate). Each population unit is attributed independently to a cell following a preferential attachment such that 
\begin{equation}
\Pb{P_i(t+1)=P_i(t)+1|P(t+1)=P(t)+1}=\frac{(P_i(t)/P(t))^{\alpha}}{\sum(P_i(t)/P(t))^{\alpha}}
\end{equation}
The attribution being uniformly drawn if all population are equal to 0.
\item A fraction $\beta$ of population is diffused to cell neighborhood (8 closest neighbors receiving each the same fraction of the diffused population). This operation is repeated $n_d$ times.
\end{enumerate}
}{
\begin{enumerate}
\item La population totale est augment√©e par un nombre fixe $N_G$ (taux de croissance). Chaque unit√© de population est attribu√©e ind√©pendamment √† une cellule suivant un attachement pr√©f√©rentiel tel que
\begin{equation}
\Pb{P_i(t+1)=P_i(t)+1|P(t+1)=P(t)+1}=\frac{(P_i(t)/P(t))^{\alpha}}{\sum(P_i(t)/P(t))^{\alpha}}
\end{equation}
L'attribution est tir√©e de mani√®re uniforme si toutes les populations sont √©gales √† 0.
\item Une fraction $\beta$ de la population est diffus√©e au voisinage de chaque cellule (les 8 plus proches voisins recevant chacun la m√™me fraction de la population diffus√©e). Cette op√©ration est r√©p√©t√©e $n_d$ fois.
\end{enumerate}
}

\bpar{
The model stops when total population reaches a fixed parameter $P_m$. To avoid bord effects such as reflecting diffusion waves, border cells diffuse their due proportion outside of the world, implying that the total population at time $t$ is strictly smaller than $N_G\cdot t$.
}{
Le mod√®le s'arr√™te que \comment[CC]{quand} la population totale atteint un param√®tre fix√© $P_m$. Pour √©viter les effets de bord comme des ondes de diffusion se r√©fl√©chissant, les cellules du bord diffusent la proportion qu'elles devraient hors du monde, ce qui implique que la population totale √† l'instant $t$ est strictement plus petite que $N_G\cdot t$.
}

\bpar{
We summarize model parameters in Table~\ref{tab:density:parameters}, giving the associated processes and values ranges we use in the simulations. The total population of the area $P_m$ is exogenous, in the sense that it is supposed to depend on macro-scale growth patterns on long times. Growth rate $N_G$ captures both endogenous growth rate and migration balance within the area. The aggregation rate $\alpha$ sets the differences in attraction between cells, what can be understood as an abstract attraction coefficient following a scaling law of population. Finally, the two diffusion parameters are complementary since diffusing with strength $n_d\cdot \beta$ is different of diffusing $n_d$ times with strength $\beta$, the later giving flatter configuration.
}{
Nous r√©sumons les param√®tres du mod√®le dans la Table~\ref{tab:density:parameters}, donnant les processus associ√©s et les bornes des valeurs utilis√©es dans les simulations. La population totale de la zone $P_m$ est exog√®ne, au sens qu'elle est suppos√©e d√©pendre de processus de croissance √† l'√©chelle macroscopique sur le temps long. Le taux de croissance $N_G$ capture √† la fois la croissance endog√®ne et la balance migratoire dans la zone. Le taux d'agr√©gation $\alpha$ fixe la diff√©rence d'attractivit√© entre cellules, qui peut √™tre interpr√©t√©e comme un coefficient abstrait d'attraction suivant une loi d'√©chelle de la population. Enfin, les deux param√®tres de diffusion sont compl√©mentaires puisque diffuser avec force $n_d\cdot \beta$ est diff√©rent de diffuser $n_d$ fois avec force $\beta$, le dernier cas donnant des configurations plus plates.
}
\comment[CC]{TB}
% table summarizing parameters
%  $\alpha \in [0.1,4],\beta \in [0,0.5],n_d \in \{1,\ldots , 5\}, N_G \in [500,30000], P_m \in [1e4,1e6]$
%%%%%%%%%%%%%
\begin{table}[!ht]
\caption[Summary of model parameters][R√©sum√© des param√®tres]{\textbf{Summary of model parameters.}\label{tab:density:parameters}}{\textbf{R√©sum√© des param√®tres}\label{tab:density:parameters}}
\begin{tabular}{|l|l|l|l|}
\hline
Param√®tre & Notation & Processus & Domaine\\ \hline
Population totale & $P_m$ & Croissance macroscopique & $[1e4,1e6]$\\ \hline
Taux de croissance & $N_G$ & Croissance mesoscopique  & $[500,30000]$\\ \hline
Force d'agr√©gation & $\alpha$ & Agr√©gation & $[0.1,4]$\\ \hline
Force de diffusion & $\beta$ & Diffusion & $[0,0.5]$\\ \hline
Nombre de diffusions & $n_d$ & Diffusion & $\{1,\ldots , 5\}$\\ \hline
\end{tabular}
\end{table}
%%%%%%%%%%%%%%


\paragraph{Measuring the Urban Form}{Mesure de la forme urbaine}

\bpar{
As our model is only density-based, we propose to quantify its outputs through spatial morphology, i.e. properties of the spatial distribution of density. At the scale chosen, these will be expected to translate various functional properties of the urban landscape. 
}{
Comme le mod√®le se base uniquement sur la densit√©, nous proposons de quantifier ses sorties par la morphologie spatiale, i.e. les propri√©t√©s de la distribution spatiale de la densit√©. A l'√©chelle choisie, on s'attend √† ce qu'elle traduise diverse propri√©t√©s fonctionnelles de l'environnement urbain. Le contexte et la d√©finition des indicateurs a d√©j√† √©t√© donn√©e en section~\ref{sec:staticcorrelations}.
}


\subsubsection{Real data}{Donn√©es r√©elles}


Nous travaillons sur les valeur \comment[CC]{s} des indicateurs calcul√©es en section~\ref{sec:staticcorrelations} pour l'Europe, sur les fen√™tres de c√¥t√© 50km avec r√©solution de 100 cellules. Nous posons donc pour la suite $N=100$ pour les simulations du mod√®le.





%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection*{Generation of urban patterns}{G√©n√©ration de structures urbaines}


\paragraph{Implementation}{Impl√©mentation}

\bpar{
The model is implemented both in NetLogo~\cite{wilensky1999netlogo} for exploration and visualization purposes, and in \texttt{Scala} for performance reasons and easy integration into OpenMole~\cite{reuillon2013openmole}, which allows a transparent access to High Performance Computing environments. Computation of indicator values on geographical data is done in \texttt{R} using the \texttt{raster} package~\cite{hijmans2015geographic}. Source code and results are available on the open repository of the project at \texttt{https://github.com/JusteRaimbault/Density}. Raw datasets for real indicator values and simulation results are available on Dataverse at \texttt{http://dx.doi.org/10.7910/DVN/WSUSBA}.
}{
Le mod√®le est impl√©ment√© √† la fois en NetLogo~\cite{wilensky1999netlogo} pour des raisons d'exploration et de visualisation, et en \texttt{Scala} pour des raisons de performance et d'int√©gration plus ais√©e dans OpenMole~\cite{reuillon2013openmole}, qui permet un acc√®s transparent aux environnements de calcul haute performance. Le calcul des valeurs des indicateurs sur les donn√©es g√©ographiques est fait en \texttt{R} avec le package \texttt{raster}~\cite{hijmans2015geographic}. Le code source et les r√©sultats sont disponibles sur le d√©p√¥t ouvert du projet\footnote{√† \texttt{https://github.com/JusteRaimbault/Density}}. Les donn√©es des valeurs r√©elles des indicateurs et des r√©sultats de simulation sont disponibles sur Dataverse\footnote{√† \texttt{http://dx.doi.org/10.7910/DVN/WSUSBA}}. Nous avons dans le cadre de l'impl√©mentation \texttt{Scala} impl√©ment√© la convolution de distribution en deux dimension\comment[CC]{s} par Transform√©e de Fourier rapide, permettant de transformer une complexit√© $O(N^4)$ en $O(N^2\log^2 N)$ \comment[CC]{une note de bas de page pour detailler un peu tout ca? le pourquoi? le comment? les notations ?}, puis impl√©ment√© les indicateurs qui ont pu √™tre int√©gr√©s √† une extension NetLogo d√©di√©e~\ref{app:subsec:morphologyextension}.
}

\paragraph{Generated Shapes}{Formes g√©n√©r√©es}


\bpar{
The model has a relatively small number of parameters but is able to generate a large variety of shapes, extending beyond existing forms. In particular, its dynamical nature allows through the interplay between $P_m$ and $N_G$ parameter to choose between final configurations that can be non-stationary or semi-stationary, whereas the interplay between $\alpha$ and $\beta$ modulates the sprawl and the compactness of forms. We run the model for parameters varying in ranges given in Table~\ref{tab:parameters}, for a world size $N=100$. Fig.~\ref{fig:fig2} shows examples of the variety of generated shapes for different parameter values, with corresponding interpretations. The four very different shapes can be obtained with variation of a single parameter sometimes: going from a peri-urban area from a rural area implies an increased aggregation at the same level of diffusion. Note that the model is density driven, and that the parameter $P_m/N_G$ is what really influences the dynamics: the values of $P_m$ are in some cases not directly corresponding to the interpretations we made (for the rural in particular) that are done on densities. A rescaling keeps the settlement form and solves this issue. These examples show the potentiality of the model to produce diverse shapes. We need then to systematically tackle its stochasticity and explore its parameter space.
}{
Le mod√®le a un nombre relativement faible de param√®tres mais est capable de g√©n√©rer une grande vari√©t√© de formes, qui s'√©tendent au del√† des formes existantes \comment[CC]{ca c'est interessant et fort. a illustrer peut-etre en renvoyant vers les figures}. Plus particuli√®rement, sa nature dynamique permet par la combinaison des param√®tres $P_m$ et $N_G$ de choisir entre des configurations qui peuvent √™tre non stationnaires ou semi stationnaires, tandis que l'interaction entre $\alpha$ et $\beta$ module l'√©talement et le caract√®re compact des formes. Nous simulons le mod√®le pour des valeurs de param√®tres variant dans les bornes donn√©es en Table~\ref{tab:density:parameters}, pour une taille de monde $N=100$. Fig.~\ref{fig:density:fig2} montre des exemples de la vari√©t√© des formes urbaines g√©n√©r√©es pour diff√©rentes valeurs des param√®tres, avec les interpr√©tations correspondantes. Parmi les quatre formes tr√®s diff√©rentes, certaines peuvent √™tre obtenues avec la variation d'un seul param√®tre seulement : passer d'une zone p√©ri-urbaine √† une zone rurale implique une agr√©gation accrue au m√™me niveau de diffusion. Il faut noter que le mod√®le est bas√© sur la densit√©, et que le param√®tre $P_m/N_G$ est celui qui influence r√©ellement la dynamique: les valeurs de $P_m$ ne correspondent dans certains cas pas directement aux interpr√©tations qui en sont faites (pour le rural en particulier) qui sont faites sur les densit√©s. Une homoth√©tie garde la forme des √©tablissements et r√©sout ce probl√®me. Ces exemples montrent la potentialit√© du mod√®le √† produire des formes diverses. Nous devons ensuite √©tudier syst√©matiquement sa stochasticit√© et explorer son espace des param√®tres.
}


%%%%%%%%%%%%%
\begin{figure}
%\includegraphics[width=\linewidth]{Figures/Density/Fig2}
%ex_sp-diffusion=0.05_sp-growth-rate=76_sp-diffusion-steps=2_sp-alpha-localization=0.4_ticks=995_sp-population=75620.00000000015.png
%ex_sp-diffusion=0.047_sp-growth-rate=274_sp-diffusion-steps=2_sp-alpha-localization=1.4_ticks=197_sp-population=53977.999999999935.png
%ex_sp-diffusion=0.0060_sp-growth-rate=25_sp-diffusion-steps=1_sp-alpha-localization=0.4_ticks=176_sp-population=4400.000000000003.png
%ex_sp-diffusion=0.0060_sp-growth-rate=268_sp-diffusion-steps=1_sp-alpha-localization=1.6_ticks=285_sp-population=76376.00000000033.png
\includegraphics[width=\linewidth]{Figures/Final/5-2-2-fig-density-fig2}
\caption[Example of the variety of generated urban shapes][Exemple de formes urbaines g√©n√©r√©es]{\textbf{Example of the variety of generated urban shapes.} \textit{(Top left)} Very diffuse urban configuration, $\alpha = 0.4,\beta = 0.05, n_d = 2, N_G = 76, P_m = 75620$; \textit{(Top Right)} Semi-stationary polycentric urban configuration, $\alpha = 1.4,\beta = 0.047, n_d = 2, N_G = 274, P_m = 53977$; \textit{(Bottom Left)} Intermediate settlements (peri-urban or densely populated rural area), $\alpha = 0.4,\beta = 0.006, n_d = 1, N_G = 25, P_m = 4400$; \textit{(Bottom Right)} Rural area, $\alpha = 1.6,\beta = 0.006, n_d = 1, N_G = 268, P_m = 76376$.\label{fig:density:fig2}}{\textbf{Exemple de la vari√©t√© de \emph{formes territoriales} g√©n√©r√©es.} \textit{(Haut Gauche)} Configuration urbaine tr√®s diffuse, $\alpha = 0.4,\beta = 0.05, n_d = 2, N_G = 76, P_m = 75620$; \textit{(Haut Droite)} Configuration polycentrique urbaine semi-stationnaire, $\alpha = 1.4,\beta = 0.047, n_d = 2, N_G = 274, P_m = 53977$; \textit{(Bas Gauche)} Etablissements interm√©diaires (p√©riurbain ou zone rurale dens√©ment peupl√©e), $\alpha = 0.4,\beta = 0.006, n_d = 1, N_G = 25, P_m = 4400$; \textit{(Bas Droite)} Zone rurale, $\alpha = 1.6,\beta = 0.006, n_d = 1, N_G = 268, P_m = 76376$.\label{fig:density:fig2}}
\end{figure}
%%%%%%%%%%%%%




%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Model Behavior}{Comportement du mod√®le}


\bpar{
In the study of such a computational model of simulation, the lack of analytical tractability must be compensated by an extensive knowledge of model behavior in the parameter space~\cite{banos2013pour}. This type of approach is typical of what Arthur calls the \emph{Computational shift in modern science}~\cite{arthur2015complexity}: knowledge is less extracted through analytical exact resolution than through intensive computational experiments, even for ``simple'' models such as the one we study.
}{
Dans l'√©tude d'un tel model computationnel de simulation, le manque de tra√ßabilit√© analytique doit √™tre compens√© par une connaissance extensive du comportement du mod√®le dans l'espace des param√®tres~\cite{banos2013pour}. Ce type d'approche est typique de ce qu'\noun{Arthur} nomme le \emph{tournant computationnel dans la science moderne}~\cite{arthur2015complexity} : la connaissance est moins extraite de r√©solutions analytiques exactes que par des exp√©riences de calcul intensif, m√™me pour des mod√®les ``simples'' comme celui que nous √©tudions.
}

\paragraph{Convergence}{Convergence}


\bpar{
First of all we need to assess the convergence of the model and its behavior regarding stochasticity. We run for a sparse grid of the parameter space consisting of 81 points, with 100 repetitions for each point. Corresponding histograms are shown in~\nameref{S1_Text}. Indicators show good convergence properties: most of indicators are easily statistically discernable across parameter points, and these are distinguished without ambiguity when taking into account all indicators. We use this experiment to find a reasonable number of repetitions needed in larger experiments. For each point, we estimate the Sharpe ratios for each indicators, i.e. mean normalized by standard deviation. The more variable indicator is Moran with a minimal Sharpe ratio of 0.93, but for which the first quartile is at 6.89. Other indicators have very high minimal values, all above 2. Its means than confidence intervals large as $1.5 \cdot \sigma$ are enough to differentiate between two different configurations. In the case of gaussian distribution, we know that the size of the 95\% confidence around the average is given by $2\cdot \sigma \cdot 1.96 / \sqrt{n}$, what gives $1.26¬†\cdot \sigma$ for $n=10$. We run therefore this number of repetitions for each parameter point in the following, what is highly enough to have statistically significant differences between average as shown above. In the following, when referring to indicator values for the simulated model, we consider the ensemble averages on these stochastic runs.
}{
Dans un premier temps il est important d'assurer la convergence du mod√®le et son comportement au regard de la stochasticit√©. Nous simulons le mod√®le pour une grille creuse de l'espace des param√®tres contenant 81 points, avec 100 r√©p√©titions √† chaque point. Les histogrammes correspondants sont montr√©s en Appendice~\ref{app:sec:density}. Les indicateurs pr√©sentent de bonnes propri√©t√©s de convergence: la plupart des indicateurs sont ais√©ment discernable\comment[CC]{s} de mani√®re statistique entre les points de param√®tres, et ceux-ci sont distinguables sans ambiguit√© quand tous les indicateurs sont pris en compte \comment[CC]{phrase un peu flottantes. a rattacher aux indicateurs, a leur valeur, a leur sens}. Nous utilisons cette exp√©rience pour √©tablir un nombre raisonnable de r√©p√©titions n√©cessaire\comment[CC]{s} pour des exp√©riences plus volumineuses. Pour chaque point, nous estimons le ratio de Sharpe pour chaque indicateur, i.e. sa moyenne normalis√©e par la d√©viation standard \comment[CC]{B}. L'indicateur le plus variable est l'index \comment[CC]{indice en francais je crois} de Moran avec un Sharpe minimal de 0.93, mais pour lequel le premier quartile est √† 6.89. Les autres indicateurs ont tous des valeurs minimales tr√®s hautes, toutes au dessus de 2. Cela signifie que des intervalles de confiance large comme $1.5 \cdot \sigma$ sont suffisants pour diff√©rencier entre deux configurations diff√©rentes. Dans le cas d'une distribution Gaussienne, nous savons que la taille de l'intervalle de confiance √† 95\% autour de la moyenne est donn√© par $2\cdot \sigma \cdot 1.96 / \sqrt{n}$, ce qui donne $1.26¬†\cdot \sigma$ pour $n=10$. Nous utilisons pour cela ce nombre de r√©p√©titions pour chaque point de param√®tres par la suite, ce qui est largement suffisant pour avoir des diff√©rences entre les moyennes √©tant statistiquement signifiantes comme montr√© pr√©c√©demment. Par la suite, lorsque nous consid√©rons les valeurs des indicateurs pour le mod√®le simul√©, nous consid√©rons la moyenne d'ensemble sur ces r√©p√©titions stochastiques.  
}


% -> 10 repetitions give 1.24 \sigma : ok with these sharp

%       id       meanMoran            sdMoran           sharpeMoran        meanSlope      
% Min.   : 0   Min.   :0.0000997   Min.   :4.387e-05   Min.   : 0.9372   Min.   :-2.1220  
% 1st Qu.:20   1st Qu.:0.0026494   1st Qu.:3.055e-04   1st Qu.: 6.8929   1st Qu.:-1.0264  
% Median :40   Median :0.0102259   Median :1.024e-03   Median :10.0594   Median :-0.7326  
% Mean   :40   Mean   :0.0245863   Mean   :1.707e-03   Mean   :12.5250   Mean   :-0.7889  
% 3rd Qu.:60   3rd Qu.:0.0330126   3rd Qu.:2.469e-03   3rd Qu.:14.1114   3rd Qu.:-0.4594  
% Max.   :80   Max.   :0.1174664   Max.   :6.309e-03   Max.   :50.0461   Max.   :-0.1470  
%    sdSlope          sharpeSlope       meanEntropy       sdEntropy         sharpeEntropy      
% Min.   :0.001956   Min.   :  9.104   Min.   :0.2161   Min.   :4.852e-05   Min.   :    6.904  
% 1st Qu.:0.004311   1st Qu.: 17.323   1st Qu.:0.5240   1st Qu.:2.192e-04   1st Qu.:   18.503  
% Median :0.019704   Median : 40.997   Median :0.8685   Median :7.370e-03   Median :   69.986  
% Mean   :0.035573   Mean   : 57.884   Mean   :0.7529   Mean   :1.618e-02   Mean   : 3244.566  
% 3rd Qu.:0.047804   3rd Qu.: 72.753   3rd Qu.:0.9865   3rd Qu.:3.037e-02   3rd Qu.: 4479.465  
% Max.   :0.225275   Max.   :293.529   Max.   :0.9982   Max.   :5.675e-02   Max.   :20571.273  
%  meanDistance       sdDistance       sharpeDistance   
% Min.   :0.09208   Min.   :0.001579   Min.   :  1.922  
% 1st Qu.:0.44556   1st Qu.:0.002742   1st Qu.:  4.243  
% Median :0.89682   Median :0.020469   Median : 24.374  
% Mean   :0.68723   Mean   :0.050225   Mean   :152.769  
% 3rd Qu.:0.91474   3rd Qu.:0.105676   3rd Qu.:326.653  
% Max.   :0.92342   Max.   :0.182181   Max.   :579.846  





\paragraph{Exploration of parameter space}{Exploration de l'espace des param√®tres}


\bpar{
We sample the Parameter space using a Latin Hypercube Sampling, with parameter as $\alpha \in [0.1,4],\beta \in [0,0.5],n_d \in \{1,\ldots , 5\}, N_G \in [500,30000], P_m \in [1e4,1e6]$. This type of cribbing is a good compromise to have a reasonable sampling without being subject to the dimensionality curse within normal computation capabilities. We sample around 80000 parameters points, with 10 repetitions each. Full plots of model behavior as a function of parameters are given in~\ref{app:sec:density}. We show in~\ref{fig:density:fig3} some particularly interesting behavior for slope $\gamma$ and average distance $\bar{d}$. First of all, the overall qualitative behavior depending on aggregation strength, namely that lower alpha giver less hierarchical and more spread configurations, confirms the expected intuitive behavior. The effect of diffusion strength $\beta$ is more difficult to grasp: the effect is inverted for slope between high and low growth rates but not for distance, that shows an inversion when $\alpha$ varies. In the low $N_G$ case, low diffusion creates more sprawled configuration when aggregation is low, but less sprawled when aggregation is high. Furthermore, all indicators show a more or less smooth transition around $\alpha \simeq 1.5$. Slope stabilize over certain values, meaning that the hierarchy cannot be forced more and indeed depends of the diffusion value, at least for low $N_G$ (right column). In general, higher valued for $P_m/N_G$ increase the effect of diffusion what could have been expected. The existence of a minimum for slope at $n_d=1,P_m/N_G\in\left[13,26\right]$ and lowest $\beta$ is unexpected and witnesses a complex interplay between aggregation and diffusion. The emergence of this ``optimal'' regime is associated with shifts of the transition points in other cases: for example, lowest diffusion imply a transition beginning at lower values of $\alpha$ for average distance. This exploration confirms that complex behavior, in the sense of unpredictable emerging forms, occurs in the model: one cannot say in advance the final form given some parameters, without referring to the full exploration of which we give an overview here.
}{
Nous √©chantillonnons l'espace des param√®tres en utilisant un \emph{Latin Hypercube Sampling}, les param√®tres variant dans $\alpha \in [0.1,4],\beta \in [0,0.5],n_d \in \{1,\ldots , 5\}, N_G \in [500,30000], P_m \in [1e4,1e6]$ \comment[CC]{pourquoi ces bornes?}. Ce type de criblage est un bon compromis pour avoir un √©chantillonnage raisonnable sans √™tre soumis au sort de la dimension dans des capacit√©\comment[CC]{s} de calcul normales. Nous √©chantillonnons autour de 80000 points, avec 10 r√©p√©titions chacun. Des graphes complets du comportement du mod√®le en fonction des param√®tres sont donn√©s en~\ref{app:sec:density}. Nous montrons en Fig.~\ref{fig:density:fig3} des comportements particuli√®rement int√©ressants pour la pente $\gamma$ et la distance $\bar{d}$ \comment[CC]{tu as oublie de precise ou repreciser la sequence: parametre, simu, indice de forme et lesquels. sinon on risque de se perdre}. Tout d'abord, le comportement qualitatif g√©n√©ral en fonction de la force d'agr√©gation, c'est √† dire que des valeurs faibles de $\alpha$ donnent des configurations moins hi√©rarchiques et plus √©tal√©es, confirme le comportement attendu intuitivement. L'effet de la force de diffusion $\beta$ est plus difficile √† cerner: l'effet est invers√© pour la pente entre des haut et bas taux de croissance mais pas pour la distance, qui elle pr√©sente une inversion quand $\alpha$ varie. Dans le cas o√π $N_G$ est faible, une diffusion faible cr√©e des configuration\comment[CC]{s} plus √©tal√©e\comment[CC]{s} quand l'agr√©gation est basse, mais moins √©tal√©es quand l'agr√©gation est forte. De plus, tous les indicateurs pr√©sentent une transition plus ou moins abrupte autour de $\alpha \simeq 1.5$. La pente se stabilise au dessus de certaines valeurs, ce qui veut dire que la hi√©rarchie ne peut pas √™tre forc√©e plus et d√©pend alors de la valeur de la diffusion, au moins pour les faibles $N_G$ (colonne de droite). En g√©n√©ral, des valeurs fortes pour $P_m/N_G$ augmentent les effets de la diffusion ce √† quoi on pouvait s'attendre. L'existence d'un minimum pour la pente √† $n_d=1,P_m/N_G\in\left[13,26\right]$ et les valeurs faibles de $\beta$ est inattendue et t√©moigne d'une interaction complexe entre agr√©gation et diffusion. L'√©mergence de ce r√©gime ``optimal'' est associ√© avec un d√©calage des points de transition dans les autres cas : par exemple une diffusion plus faible implique une transition commen√ßant √† des valeurs plus faible de $\alpha$ pour la distance. Cette exploration confirme qu'un comportement complexe, au sens de formes √©mergentes qui ne peuvent √™tre pr√©dites, est pr√©sent dans le mod√®le : il n'est pas possible de donner en avance la forme finale √©tant donn√© un jeu de param√®tres, sans se r√©f√©rer √† l'exploration compl√®te dont nous avons donn√© un aper√ßu ici.
}



%%%%%%%%%%%%%
\begin{figure}
%\includegraphics[width=\linewidth]{Figures/Density/Fig3.png}
\includegraphics[width=\linewidth]{Figures/Final/5-2-2-fig-density-fig3}
\caption[Behavior of indicators][Comportement des indicateurs]{\textbf{Behavior of indicators.} Slope $\gamma$ (top row) and average distance $\bar{d}$ (bottom row) as a function of $\alpha$, for different bins for $\beta$ given by curve color, for particular values $n_d=1,P_m/N_G\in\left[13,26\right]$ (left column) and $n_d=4,P_m/N_G\in\left[41,78\right]$ (right column).\label{fig:density:fig3}}{\textbf{Comportement des indicateurs.} Pente $\gamma$ (ligne du haut) et distance moyenne $\bar{d}$ (ligne du bas) comme fonction de $\alpha$, pour diff√©rentes valeurs de $\beta$ donn√©es par la couleur des courbes, pour des valeurs particuli√®res $n_d=1,P_m/N_G\in\left[13,26\right]$ (colonne de gauche) et $n_d=4,P_m/N_G\in\left[41,78\right]$ (colonne de droite). On observe dans chaque cas une transition en fonction de $\alpha$, dont les propri√©t√©s sont influenc√©es par les autres param√®tres. Pour les faibles valeurs de $P_m/N_G$ et de $\beta$ √©merge une non-monotone contre intuitive.\label{fig:density:fig3}}
\end{figure}
%%%%%%%%%%%%%






%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Semi-analytical Analysis}{Analyse semi-analytique}


\bpar{
Our model can be understood as a type of reaction-diffusion model, that have been widely used in other fields such as biology: similar processes were used for example by Turing in its seminal paper on morphogenesis~\cite{turing1952chemical}. An other way to formulate the model typical to these approaches is by using Partial Differential Equations. We propose to gain insights into long-time dynamics by studying them on a simplified case. We consider the system in one dimension, such that $x\in \left[0;1\right]$ with $1/\delta x$ cells of size $\delta x$. A time step is given by $\delta t$. Each cell is characterized by its population as a random variable $P(x,t)$. We work on their expected values $p(x,t) = \Eb{P(x,t)}$, and assume that $n_d=1$. As developed in Supplementary Material~\ref{app:sec:density}, we show that this simplified process verifies the following PDE:
}{
Notre mod√®le peut √™tre compris comme un type de mod√®le de r√©action-diffusion, qui ont √©t√© utilis√©s largement dans d'autres champs comme la biologie: des processus similaires ont par exemple √©t√© utilis√©s par \noun{Turing} dans son article s√©minal sur la morphogen√®se~\cite{turing1952chemical} \comment[CC]{deja dit dans la section precedente}. Une autre fa√ßon de formuler le mod√®le typique √ \comment[CC]{de}† ces approches est d'utiliser des Equations aux D√©riv√©es Partielles (EDP). Dans le cas d'un mod√®le de croissance de firmes, g√©n√©ralisation du mod√®le de Simon avec forme quelconque de la fonction d'attachement, \cite{2017arXiv171007580R} montre qu'une EDP et sa solution g√©n√©rale peuvent √™tre d√©riv√©es. Notre cas est plus d√©licat par l'ajout du processus de diffusion. Nous proposons d'√©clairer des comportements des dynamiques de temps long en les √©tudiant sur un cas simplifi√©. Nous consid√©rons le syst√®me en une dimension, tel que $x\in \left[0;1\right]$ avec $1/\delta x$ cellule de taille $\delta x$. Un pas de temps est donn√© par $\delta t$. Chaque cellule est caract√©ris√©e par sa population comme une variable al√©atoire $P(x,t)$.\comment[FL]{notations ne sont pas claires} Nous travaillons sur les esp√©rances $p(x,t) = \Eb{P(x,t)}$, et supposons que $n_d=1$. Comme d√©velopp√© en Information Suppl√©mentaire~\ref{app:sec:density}, on peut montrer que ce processus simplifi√© ob√©it √† la PDE \comment[CC]{EDP plus haut} suivante :
}


\begin{equation}\label{eq:pde}
\hspace{-1.5cm}
\delta t \cdot \frac{\partial p}{\partial t} = \frac{N_G \cdot p^{\alpha}}{P_{\alpha}(t)} + \frac{\alpha \beta (\alpha - 1) \delta x^2}{2}\cdot \frac{N_G \cdot p^{\alpha-2}}{P_{\alpha}(t)} \cdot \left(\frac{\partial p}{\partial x}\right)^2 + \frac{\beta \delta x^2}{2} \cdot \frac{\partial^2 p}{\partial x^2} \cdot\left[ 1 + \alpha \frac{N_G p^{\alpha - 1}}{P_{\alpha(t)}} \right]
\end{equation}


\bpar{
where $P_{\alpha}(t) = \int_x p(x,t)^{\alpha} dx$. This non-linear equation can not be solved analytically, the presence of integral terms putting it out of standard methods, and numerical resolution must be used~\cite{tadmor2012review}. It is important to note that the simplified model can be expressed by a PDE analog to reaction-diffusion equations, as the one partially solved for a simpler model in~\cite{bosch1990velocity}. We show in \ref{app:sec:density} that because of the boundaries conditions, density (proportion of population) converges towards a stationary solution at long times, going through intermediate states in which the solution is partially stabilized, in the sense that its evolution speed becomes rather slow. These ``semi-stationary'' states are the ones used in two dimensions along with the dynamical ones. This study confirms that the variety of shapes obtained through the model is permitted both by the interplay of aggregation and diffusion as the equation couples them, but also by the values of $P_m / N_G$ that allow to set the convergence level. Indeed, the sensitivity of the stationary solution to parameters is very low compared to the shape of the world, and using the model in stationary mode would make no sense in our case. Finally, we use this toy case to demonstrate the importance of bifurcations in model dynamics. More precisely, we show that path-dependence is crucial for the final form. As illustrated in Fig.~\ref{fig:density:fig4}, using an initial condition making the choice ambiguous, corresponding to five equidistant equally populated cells, produces very different trajectories, as generally one of the spots will end dominating the others, but is totally random, witnessing dramatic bifurcations in the system at initial times. This aspect is typically expected in urban systems, and confirms the importance of robust indicators described before.
}{
o√π $P_{\alpha}(t) = \int_x p(x,t)^{\alpha} dx$. Cette √©quation non-lin√©aire ne peut pas √™tre r√©solue analytiquement, la pr√©sence de termes int√©graux la mettant hors des m√©thodes standard, et la r√©solution num√©rique doit √™tre utilis√©e~\cite{tadmor2012review}. Il est important de noter que le mod√®le simplifi√© peut √™tre exprim√© comme une PDE \comment[CC]{EDP} analogue aux √©quations de r√©action-diffusion, comme celle partiellement r√©solue pour un mod√®le plus simple dans~\cite{bosch1990velocity}. Nous montrons en \ref{app:sec:density} qu'√† cause des conditions au bord, la densit√© (au sens de la proportion de population) converge vers une solution stationnaire sur le temps long, en passant par des √©tats interm√©diaires pour lesquels la solution est partiellement stabilis√©e, au sens o√π sa vitesse d'√©volution devient relativement lente. Ces √©tats ``semi-stationnaires'' sont ceux utilis√©s en deux dimensions avec les √©tats dynamiques. Cette √©tude confirme que la vari√©t√© des formes obtenue \comment[CC]{s} par le mod√®le est permise √† la fois par l'interactions entre l'agr√©gation et la diffusion puisque l'√©quation les couple, mais aussi par les valeurs de $P_m / N_G$ qui permet de fixer le niveau de convergence. En effet, la sensibilit√© de la solution stationnaire aux param√®tres est tr√®s faible en comparaison de la forme du monde (en √©cho √† notre √©tude sur la sensibilit√© aux conditions spatiales initiales en~\ref{sec:computation}), et utiliser le mod√®le en mode stationnaire n'aurait aucun sens dans notre cas. Enfin, nous utilisons ce cas simplifi√© pour d√©montrer l'importance des bifurcations dans la dynamique du mod√®le. Plus pr√©cis√©ment, nous montrons que la d√©pendance au chemin est cruciale pour la forme finale. Comme illustr√© en Fig.~\ref{fig:density:fig4}, l'utilisation d'une condition initiale rendant les choix ambigus, correspondant √† 5 cellules √©quidistantes et de population √©gale, produit des trajectoires tr√®s diff√©rentes, puisqu'en g√©n√©ral l'un des lieux finira par dominer les autres, mais est compl√®tement al√©atoire, t√©moignant de bifurcations cruciales dans le syst√®me aux instants initiaux. Cet aspect est typiquement attendu dans les syst√®mes urbains \comment[CC]{illustrer: dans le cas de sites intialement defensifs ou d'une ressource tres locale qui determine pour les centaines d'annees a venir la forme de la densite a cet endroit}, et confirme l'importance d'indicateurs morphologiques robustes d√©crits pr√©c√©demment.
}


%%%%%%%%%%%%%
\begin{figure}[h!]
%\includegraphics[width=\linewidth]{Figures/Density/Fig4.png}
\includegraphics[width=\linewidth]{Figures/Final/5-2-2-fig-density-fig4}
\caption[Randomness and frozen accidents][D√©pendance au chemin]{\textbf{Randomness and frozen accidents.} We show nine random realizations of the one dimensional system with similar initial conditions, namely five equidistant equally populated initial cells. Parameters are $\alpha = 1.4,\beta =0.1,N_G=10$. Each plot shows time against space, color level giving the proportion of population in each cell.\label{fig:density:fig4}}{\textbf{Al√©atoire et accidents fig√©s.} Nous montrons 9 r√©alisations al√©atoires du syst√®me √† une dimension avec des conditions initiales identiques, c'est √† dire 5 cellules √©quidistantes peupl√©es √©galement √† l'instant initial. Les param√®tres sont $\alpha = 1.4,\beta =0.1,N_G=10$. Chaque graphe montre le temps contre l'espace, le niveau de couleur donnant la proportion de population dans chaque cellule.\label{fig:density:fig4}}
\end{figure}
%%%%%%%%%%%%%

\comment[CC]{figure qui a l'air interessante mais pas claire du tout: c'est quoi X et c'est quoi "proportion" ?}



%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Model Calibration}{Calibration du mod√®le}


\bpar{
We finally turn to the the calibration of the model, that is done on the morphological objectives. As a single calibration for each real cell is computationally out of reach, we use the previous model exploration and superpose the point clouds with real indicator values. Full scatterplots of all indicators against each other, for simulated and real configurations, are given in~\ref{app:sec:density}. We find that the real point cloud is mostly contained within the simulated, that extend in significantly larger areas. It means that for a large majority of real configuration, there exist model parameters producing in average exactly the same morphological configuration. The highest discrepancy is for the distance indicator, the model failing to reproduce configuration with high distance, low Moran and intermediate hierarchy. These could for example correspond to polycentric configurations with many consequent centers. We consider a more loose calibration constraint, by doing a Principal Component Analysis on synthetic and real morphological values, and consider the two first components only. These represent 85\% of cumulated variance. The rotated point clouds along these dimensions are shown in Fig.~\ref{fig:density:densitycalib}. Most of real point cloud falls in the simulated one in this simplified setting. We illustrate particular points with real configurations and their simulated counterparts: for example Bucharest, Romania, corresponds to a monocentric semi-stationary configuration, with very high aggregation but also diffusion and a rather low growth rate. Other examples show less populated areas in Spain and Finland. From the plots giving parameter influence, we can show that most real situation fall in the region with intermediate $\alpha$ but quite varying $\beta$. It is consistent with real scaling urban exponents having a variation range rather small (between 0.8 and 1.3 generally~\cite{pumain2006evolutionary}) compared to the one we allowed in the simulations, whereas the diffusion processes may be much more diverse. This way, we have shown that the model is able to reproduce most of existing urban density configuration in Europe, despite its rather simplicity. It confirms that in terms of urban form, most of drivers at this scale can be translated into these abstract processes of aggregation and diffusion, but also that function must be quite correlated with form since the dimension of function (with an additional economic dimension in form for example) is not taken into account in the model.
}{
Nous traitons finalement la calibration du mod√®le, qui est faite sur les objectifs morphologiques. Comme une calibration pour chaque cellule r√©elle est hors de port√©e en terme de calcul, nous utilisons l'exploration pr√©c√©dente du mod√®le et superposons le nuage de points avec les valeurs r√©elles des indicateurs. Les scatterplots complets de chaque indicateur contre les autres \comment[CC]{??}, pour les configurations simul√©es et les r√©elles, sont donn√©s en~\ref{app:sec:density}. Nous constatons que le nuage de points r√©els est en majorit√© contenu dans le simul√©, qui s'√©tend sur des zones significativement plus grandes. Cela signifie que pour une grande majorit√© des configurations r√©elles, il existe des valeurs des param√®tres qui produisent en moyenne exactement la m√™me configuration morphologique \comment[CC]{mal dit. plutot: la meme configuration telle que resumee par les indicateurs de forme}. Les plus grands √©carts est \comment[CC]{sont} pour l'indicateur de distance, le mod√®le √©chouant √† produire des configurations avec une valeur √©lev√©e de la distance, un Moran faible et une hi√©rarchie interm√©diaire. Cela peut par exemple correspondre √† des configurations polycentriques avec de nombreux centres cons√©quents. Nous consid√©rons une contrainte de calibration plus faible, en proc√©dant √† une analyse en composantes principales sur les valeurs normalis√©es des indicateurs morphologiques pour les configurations synth√©tiques et r√©elles, et ne consid√©rons que les deux premi√®res composantes seulement. Celles-ci repr√©sentent 85\% de la variance cumul√©e. Les nuages de points projet√© sur ces dimensions est montr√© en Fig.~\ref{fig:density:densitycalib}. La majorit√© du nuage r√©el tombe dans le simul√© dans cette configuration simplifi√©e. Nous illustrons des points particuliers avec des configurations r√©elles et leur contrepartie simul√©e: par exemple Bucarest, Roumanie, correspond √† une configuration monocentrique semi-stationnaire, avec une forte agr√©gation mais aussi diffusion et un taux de croissance plut√¥t bas. Les autres exemples montrent des zones moins peupl√©es en Espagne et en Finlande. A partir des graphes montrant l'influence des param√®tres, on peut montrer que la plupart des situations r√©elles tombent dans la r√©gion avec des valeurs interm√©diaires pour $\alpha$ mais $\beta$ assez variable. Cela est coh√©rent avec le fait que les exposants de lois d'√©chelles urbaines ont une plage de variation plut√¥t √©troite (entre 0.8 et 1.3 g√©n√©ralement~\cite{pumain2006evolutionary}) compar√©e √† celle que nous avons permis dans les simulations, tandis que les processus de diffusion peuvent √™tre bien plus divers. Ainsi, nous avons montr√© que le mod√®le est capable de reproduire la majorit√© des configuration de densit√© en Europe, malgr√© sa relative simplicit√©. Cela confirme qu'en terme de forme urbaine, la plupart des facteurs √† cette √©chelle peuvent √™tre traduits dans ces processus abstraits d'agr√©gation et de diffusion, mais aussi que la fonction doit √™tre relativement corr√©l√©e √† la forme puisque la dimension fonctionnelle (avec une dimension √©conomique suppl√©mentaire dans la forme par exemple) n'est pas prise en compte dans le mod√®le. \comment[CC]{je n'ai pas saisi l'argumentaire pour dire que la fonction est correlee. pourtant, c'est important!}
}


% Calib 1 :
% real : PC1 = 0.9544645 ; PC2 = 0.3296364 ; coordinates : -2.607152,39.74274 - Spain, Castilla-La Mancha, Cuenca ; synth : PC1 = 0.9487267 PC2 = 0.3245882 ; beta=0.108 ; NG=637 ; nd=1 ; alpha=1.14 ; population=13235.648362769914
% Calib 2 :
% real : PC1 = 0.7004772 ; PC2 = 0.2195029 ; coordinates : 27.16068,65.889 - Finland, Lapland;  synth :  PC1 = 0.6870686 ; PC2 = 0.2287785 ; beta=0.0060 ; NG=25 ; nd=1 ; alpha=0.4 ; population=849.895449367323
% Calib 3 :
% real : PC1 = 1.017064 ; PC2 = 0.3510089 ; coordinates : -2.561874,41.30203 - Spain, Castilla et Leon, Soria ; synth : PC1 = 1.005976 PC2 = 0.3950987 ; beta=0.166; NG=100;nd=1;alpha=1;population=10017.238452906771
% Calib 4 :
% real : PC1 = -0.00177 ; PC2 = 0.6006739 ; coordinates : 25.7361,44.69989 - Romania, Bucharest ; synth : PC1 = -0.0543461 PC2 = 0.5798307 ; beta=0.432;NG=1273;nd=4;alpha=3.87;population=63024.359885979036


%%%%%%%%%%%%%%%
\begin{figure}
%\includegraphics[width=\linewidth]{Figures/Density/Fig5}
\includegraphics[width=\linewidth]{Figures/Final/5-2-2-fig-density-fig5}
\caption[Model calibration][Calibration du mod√®le]{\textbf{Model calibration.} \textit{(Top)} Simulated configurations in the two first principal components plan, color level giving the influence of $\alpha$ (left) and of $\beta$ (right); \textit{(Bottom)} Simulated points in the same space (in black) with real configurations (in red). We show around the plot typical examples of real configurations and their simulated counterparts in different regions of the space, the first being the real and the second the simulated in each case: Top left geographical coordinates 25.7361,44.69989 - Romania, Bucharest - simulation parameters $\alpha=3.87,\beta=0.432,N_G=1273,nd=4,P_m=63024$ ; Top right geographical coordinates -2.561874,41.30203 - Spain, Castilla et Leon, Soria - simulation parameters $\alpha=1,\beta=0.166,N_G=100,nd=1,P_m=10017$; Bottom left geographical coordinates 27.16068,65.889 - Finland, Lapland - simulation parameters $\alpha=0.4,\beta=0.006,N_G=25,nd=1,P_m=849$; Bottom right geographical coordinates -2.607152,39.74274 - Spain, Castilla-La Mancha, Cuenca - simulation parameters $\alpha=1.14,\beta=0.108,N_G=637,nd=1,P_m=13235$.\label{fig:densitycalib}}{\textbf{Calibration du mod√®le.} \textit{(Haut)} Configurations simul√©es dans le plan des deux premi√®res composantes principales, le niveau de couleur donnant l'influence de $\alpha$ (gauche) et de $\beta$ (droite); \textit{(Bas)} Points simul√©s dans le m√™me espace (en noir) avec les configurations r√©elles (en rouge). Autour du graphe sont montr√©s des exemples typiques de configurations r√©elles et leur contrepartie simul√©e dans diff√©rentes r√©gions de l'espace, le premier √©tant le r√©el et le second le simul√© dans chaque cas: haut gauche coordonn√©es 25.7361,44.69989 - Romania, Bucharest - param√®tres $\alpha=3.87,\beta=0.432,N_G=1273,nd=4,P_m=63024$ ; Haut droite coordonn√©es -2.561874,41.30203 - Spain, Castilla et Leon, Soria - param√®tres $\alpha=1,\beta=0.166,N_G=100,nd=1,P_m=10017$; Bas gauche coordonn√©es 27.16068,65.889 - Finland, Lapland - param√®tres $\alpha=0.4,\beta=0.006,N_G=25,nd=1,P_m=849$; Bas droite coordonn√©es -2.607152,39.74274 - Spain, Castilla-La Mancha, Cuenca - param√®tres $\alpha=1.14,\beta=0.108,N_G=637,nd=1,P_m=13235$.\label{fig:densitycalib}}
\end{figure}
%%%%%%%%%%%%%%


%%%%%%%%%%%%%%
\subsection{Discussion}{Discussion}




\paragraph{Calibration and model refinement}{Raffinement de la calibration et du mod√®le}


\bpar{
Further work on this simple model may consist in extracting the exact parameter space covering all real situations and provide interpretation of its shape, in particular through correlations between parameters and expressions of boundaries functions. Its volume in different directions should furthermore give the relative importance of parameters. Concerning the feasible space for the model of simulation itself, we tested a targeted exploration algorithm, giving promising results. More precisely, the Parameter Space Exploration (PSE) algorithm~\cite{10.1371/journal.pone.0138212} which is implemented in OpenMole, is aimed at determining all the possible outputs of a simulation model, i.e. samples its output space rather than input space. We obtain promising results as shown in Fig.~\ref{fig:fig6}: we find that the lower bound in Moran-entropy plan, confirmed by the algorithm, unexpectedly exhibit a scaling relationship. It would mean that at a given level of auto-correlation, that one could want to attain for sustainability reasons for example (optimality through co-location), imposes a minimal disorder in the configuration of activities. Other relations between indicators and as a function of parameters can be the object of similar future developments. The question of doing a dynamical calibration of the model, i.e. trying to reproduce configurations at successive times, is conditioned to the availability of population data at this resolution in time.
}{
Des d√©veloppements futurs sur ce mod√®le simple peuvent consister √† l'extraction de l'espace des param√®tres exact couvrant l'ensemble des situations r√©elles et fournir une interpr√©tation de sa forme, en particulier par les corr√©lations entre les param√®tres et les expressions des fonctions de bordure. Son volume dans diff√©rentes directions devrait de plus donner l'importance relative des param√®tres. Concernant l'espace faisable pour le mod√®le de simulation en lui-m√™me, nous avons test√© un algorithme d'exploration cibl√©e, qui donne des r√©sultats prometteurs. Plus pr√©cis√©ment, l'algorithme PSE~\cite{10.1371/journal.pone.0138212} qui est impl√©ment√© dans OpenMole, a pour but de d√©terminer toutes les sorties possibles d'un mod√®le de simulation, c'est √† dire √©chantillonne son espace de sortie plut√¥t que d'entr√©e. Nous obtenons des r√©sultats int√©ressants comme montr√© en Fig.~\ref{fig:density:fig6}: nous trouvons que la borne inf√©rieure dans le plan Moran-entropie, confirm√©e par l'algorithme, exhibe une loi d'√©chelle de mani√®re inattendue (puisqu'il est impossible a priori de d√©terminer cet espace non-faisable avec seule les formules des \comment[CC]{supprimer des} d'indicateurs, celui-ci √©tant t√©moin de la r√©alit√© de structures urbaines m√™me simul√©es). Cela voudrait dire qu'√† un niveau fix√© d'auto-corr√©lation, qu'on pourrait vouloir atteindre pour des raisons de soutenabilit√© par exemple (optimalit√© par co-localisation), impose un d√©sordre minimal dans la configuration des activit√©s. D'autres relations entre indicateurs et comme fonction des param√®tres peut √™tre l'objet de d√©veloppements futurs similaires. La possibilit√© d'une calibration dynamique du mod√®le, i.e. essayer de reproduire des configurations √† des dates successives, est conditionn√©e √† la disponibilit√© des donn√©es de population √† cette r√©solution dans le temps.
}

% application of Calibration Profile algo to check relative influence of parameters ? out of context not interesting

%%%%%%%%%%%%%
\begin{figure}
%\includegraphics[width=\linewidth]{Figures/Density/Fig6.png}
\includegraphics[width=\linewidth]{Figures/Final/5-2-2-fig-density-fig6}
\caption[PSE exploration][Exploration par PSE]{\textbf{PSE exploration.} Scatterplot of Moran against Entropy, with blue points obtained with LHS and red with PSE exploration. Green dashed line gives feasible lower bound.\label{fig:density:fig6}}{\textbf{Exploration par PSE.} Scatterplot de l'entropie en fonction de Moran, les points bleus √©tant obtenus par LHS et les rouges par PSE. La ligne pointill√©e verte donne la borne inf√©rieur faisable.\label{fig:density:fig6}}
\end{figure}
%%%%%%%%%%%%%


\bpar{
We aimed at using abstract processes rather than having a highly realistic model. Tuning some mechanisms is possible to have a model closer to reality in microscopic processes: for example thresholding the local population density, or stopping the diffusion at a given distance from the center if it is well defined. It is however far from clear if these would produce such a variety of forms and could be calibrated in a similar way, as being accurate locally does not mean being accurate at the mesoscopic level for morphological indicators. Allowing the parameters to locally vary, i.e. being non stationary in space, or adding randomness to the diffusion process, are also potential model refinements.
}{
Nous avons vis√© √† utiliser des processus abstraits plut√¥t que d'avoir un mod√®le hautement r√©aliste. La modification de certains m√©canismes est possible pour avoir un mod√®le plus proche de la r√©alit√© des processus microscopiques: par exemple plafonner la densit√© de population locale, ou stopper la diffusion √† une distance donn√©e du centre s'il est bien d√©fini. Il est cependant loin d'√™tre clair si ceux-ci produiraient une telle vari√©t√© de formes et pourraient √™tre calibr√©s de la m√™me fa√ßon, puisqu'√™tre pr√©cis localement n'implique pas d'√™tre pr√©cis au niveau mesoscopique pour les indicateurs morphologiques. Permettre aux param√®tres de varier localement, i.e. √™tre non-stationnaires dans l'espace, ou ajouter de l'al√©atoire au processus de diffusion, sont √©galement des raffinements potentiels du mod√®le.
}


\bpar{
In conclusion, we have provided a calibrated spatial urban morphogenesis model at the mesoscopic scale that can reproduce any European urban pattern in terms of morphology. We demonstrate that the abstract processes of aggregation and diffusion are sufficient to capture urban growth processes at this scale. It is meaningful in terms of policies based on urban form such as energy efficiency, but also means that issues out of this scope must be tackled at other scales or through other dimensions of urban systems.
}{
En conclusion, nous avons produit un mod√®le spatial de morphogen√®se urbaine √† l'√©chelle mesoscopique, dont la calibration permet de reproduire n'importe quelle configuration urbaine Europ√©enne en terme de morphologie. Nous d√©montrons que les processus abstraits d'agr√©gation et diffusion sont suffisants pour capturer la dimension morphologique des processus de croissance urbaine √† cette √©chelle. Cela a des implications par exemple en terme de politiques bas√©es sur la forme urbaine comme l'efficacit√© √©nerg√©tique, mais aussi signifie que les questions hors de ce cadre doivent √™tre trait√©es √† d'autres √©chelles ou par d'autres dimensions des syst√®mes urbains.
}





\stars











